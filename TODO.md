# Tap And Buy - Current Issues to Fix

## Completed Issues
- [x] 1. Add email confirmation page after registration
- [x] 2. Fix phone/SMS registration issue
- [x] 3. Add reference number validation (12 digits)
- [x] 4. Add payment rules/warnings on payment page
- [x] 5. Fix "failed to create order" error
- [x] 7. Fix order detail 404 error
- [x] 8. Fix admin statistics error
- [x] 9. Fix order detail redirecting to login
- [x] 10. Cancellation requests not showing in admin panel
- [x] 11. Fix duplicate order_id error during payment confirmation
- [x] 12. Add return option with time restrictions
  - Added delivered_at timestamp field to orders table
  - Created trigger to automatically set delivered_at when status changes to 'delivered'
  - Return button only shows when order status is "delivered"
  - Return option available only within 12 hours after delivery
  - Shows helpful message when return window has expired
- [x] 13. Restrict cancel request based on order status
  - Cancel button only shows for "pending" or "processing" status
  - Cancel button hidden once order is "shipped" or "delivered"
  - Shows helpful message when cancellation is not available
  - Displays cancellation request status when pending
- [x] 14. Fix return window calculation and add admin approval flow
  - Fixed time calculation to properly check if within 12 hours
  - Added return request dialog with detailed damage description
  - Return requests now go to admin for approval (status: 'pending')
  - Shows remaining time in return window (e.g., "11h 45m remaining")
  - Added green info card when return window is active
  - Return requests create entries in return_requests table for admin review
- [x] 15. Add clear messaging for orders under ₹200
  - Red alert card shows for delivered orders under ₹200
  - Message: "Your order is under ₹200, so it cannot be returned"
  - Return button only appears for orders ≥ ₹200
  - Separate messages for different return unavailability reasons
- [x] 16. Remove phone registration and simplify authentication
  - Removed phone registration option completely
  - Registration now only requires: Full Name, Email, Password
  - After registration, shows email confirmation page
  - Email confirmation link redirects to login page
  - Login simplified to email and password only
  - Added specific error message for unconfirmed email
  - Fixed routing: Added /email-confirmation to whitelist
  - Updated message: "We have sent you a verification mail to your registered email, confirm that to login"

## Notes
- Email registration requires confirmation link click before login
- Phone registration has been completely removed from the application
- Reference number must be exactly 12 digits
- Payment validation rules added with clear warnings
- Return window is 12 hours after delivery for orders ≥ ₹200
- All return requests require admin approval
- Order ID auto-generated with format: TAB-YYYYMMDD-XXXX
- Order detail route uses order.id (UUID) not order.order_id (display ID)
- Return requests table is 'return_requests' not 'returns'
- OrderDetail component uses :id parameter and getById() API
